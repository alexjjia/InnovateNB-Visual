<html>
  <head>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load("visualization", "1.1", {packages:["sankey"]});
      google.setOnLoadCallback(drawChart);

      function drawChart() {
        var data = new google.visualization.DataTable();

        var scale = 400; //Scale used to have the graph fit more easily within browser windows.

        data.addColumn('string', 'Revenue');
        data.addColumn('string', 'Budget');
        data.addColumn('number', 'Appropriations');
       data.addColumn({type: 'string', role: 'tooltip', 'p': {'html' : true}});
        data.addRows([


          //Quick fix to making the .html load on browser if having difficulty doing so:
          // 1. Comment out lines 16, 26-95
          // 2. Un-comment line 25.
          // 3. Reload the page.
          // 4. Do the opposite of steps 1 and 2. (un-comment where commented, and vice versa.)
            // ['Node A', 'Node B', 2] //Used as a 'quick-fix' to make the .html file run on certain browsers.

          [ 'Revenue', 'Surplus', 900000.00/scale, '$900,000.00/108,846,022.49 Total'],
          [ 'Revenue', 'Local Revenues', 26334793.97/scale, '$26,334,793.97/108,846,022.49 Total'],
          [ 'Revenue', 'State Aid without Offsetting Appropriations',  15472969.22/scale, '$15,472,969.22/108,846,022.49 Total'],
          [ 'Revenue', 'Dedicated Uniform Construction Code Fees Offset with Appropriations', 1020000/scale, '$1,020,000/108,846,022.49 Total'],
          [ 'Revenue', 'Shared Service Agreements', 3130174/scale, '$3,130,174/108,846,022.49 Total'],
          [ 'Revenue', 'Public and Private Revenues', 243340.06/scale, '$243,340.06/108,846,022.49 Total'],
          [ 'Revenue', 'Other Special Items', 4402692.21/scale, '$4,402,692.21/108,846,022.49 Total'],
          [ 'Revenue', 'Local Tax for Municipal Purposes Including Reserve for Uncollected Taxes', 30003736.4/scale, '$30,003,736.40/108,846,022.49 Total'],
          [ 'Revenue', 'Addition to Local District School Tax', 1500256.28/scale, ' $1,500,256.28/108,846,022.49 Total'],
          [ 'Revenue', 'Minimum Library Tax', 1048365.77/scale, '$1,048,365.77/108,846,022.49 Total'],
          [ 'Revenue', 'Rents', (9548000+11212000)/scale, '$20,760,000/108,846,022.49 Total'],
          [ 'Revenue', 'Miscellaneous', (804298.98+1147395.6)/scale, '$1,951,694.58/108,846,022.49 Total'],
          [ 'Revenue', 'Service to Other Systems', 1111000/scale, '$1,111,000/108,846,022.49 Total'],
          [ 'Revenue', 'Additional Billings- Ordinance O-121407', 477000/scale, '$477,000/108,846,022.49 Total'],
          [ 'Revenue', 'Additional Billings- Ordinance O-121408', 490000/scale, '$490,000/108,846,022.49 Total'],

          //Column 1 General Budget; AKA Revenue Source for General Budget
          [ 'Surplus', 'General Budget', 900000.00/scale, '$900,000.00'],
          [ 'Local Revenues', 'General Budget', 26334793.97/scale, '$26,334,793.97'],
          [ 'State Aid without Offsetting Appropriations', 'General Budget', 15472969.22/scale, '$15,472,969.22'],
          [ 'Dedicated Uniform Construction Code Fees Offset with Appropriations', 'General Budget', 1020000/scale, '$1,020,000'],
          //Special Items of Generated Revenue Anticipated with Prior Written Consent of Director of Local Government Services
          [ 'Shared Service Agreements', 'General Budget', 3130174/scale, '$3,130,174'],
          [ 'Public and Private Revenues', 'General Budget', 243340.06/scale, '$243,340.06'],
          [ 'Other Special Items', 'General Budget', 4402692.21/scale, '$4,402,692.21'],

          [ 'Local Tax for Municipal Purposes Including Reserve for Uncollected Taxes', 'General Budget', 30003736.4/scale, '$30,003,736.40'],
          [ 'Addition to Local District School Tax', 'General Budget', 1500256.28/scale, ' $1,500,256.28'],
          [ 'Minimum Library Tax', 'General Budget', 1048365.77/scale, '$1,048,365.77'],
          //Total: $84,056,327.91

          // Column 1 Water Utility; AKA Revenue Source for Water Utility
          [ 'Rents', 'Water & Sewage Utility Budget', (9548000+11212000)/scale, '$20,760,000'], //$11212000 from Sewage, $9548000 from Water
          [ 'Miscellaneous', 'Water & Sewage Utility Budget', (804298.98+1147395.6)/scale, '$1,951,694.58'],
          [ 'Service to Other Systems', 'Water & Sewage Utility Budget', 1111000/scale, '$1,111,000'],
          [ 'Additional Billings- Ordinance O-121407', 'Water & Sewage Utility Budget', 477000/scale, '$477,000'],
          //Total: $11,940,298.98

        //[ 'Rents', 'Water & Sewage Utility Budget', 11212000], NOTE: We merged the rents from the Water and Sewage Utility budgets into a single value.
          [ 'Additional Billings- Ordinance O-121408', 'Water & Sewage Utility Budget', 490000/scale, '$490,000'],
          //Total: $12,849,395.60

          //Column 2 General Budget; Appropriation Distribution for General Budget.
          [ 'General Budget', 'General Budget Government', 545358/scale, '$545,358'],
          [ 'General Budget', 'Dpt. of Administration', 15823089.74/scale, '$15,823,089.74'],
          [ 'General Budget', 'Dpt. of Policy and Economic Development', 132609.79/scale, '$132,609.79'],
          [ 'General Budget', 'Dpt. of Law', 506268.4/scale, '$506,268.40'],
          [ 'General Budget', 'Dpt. of Finance', 931173.1/scale, '$931,173.10'],
          [ 'General Budget', 'Dpt. of Engineering', 354204/scale, '$354,204'],
          [ 'General Budget', 'Dpt. of Public Works', 5462640.42/scale, '$5,462,640.42'],
          [ 'General Budget', 'Dpt. of Social Services', 1720023.7/scale, '$1,720,023.70'],
          [ 'General Budget', 'Dpt. of Police', 19059873.67/scale, '$1,905,9873.67'],
          [ 'General Budget', 'Dpt. of Fire', 11214118.65/scale, ' $11,214,118.65'],
          [ 'General Budget', 'Municipal Court', 1210498.82/scale, '$1,210,498.82'],
          [ 'General Budget', '(N.J.A.C. 5:23-4.17)', 486685/scale, '$486,685'], //Uniform Construction Code- Appropriations Offset by Dedicated Revenues
          [ 'General Budget', 'Unclassified', 3857884.5/scale, '$3,857,884.50'],
          [ 'General Budget', 'Statutory Expenditures', 8473796.25/scale, '$8,473,796.25'],
          [ 'General Budget', 'Public Library', 1357795.32/scale, '$1,357,795.32'],
          [ 'General Budget', 'Recycling', 55500/scale, '$55,500'],
          [ 'General Budget', 'Interlocal Municipal Service Agreements', 3130174/scale, '$3,130,174'],
          [ 'General Budget', 'Public and Private Programs Offset by Revenues', 277786.06/scale, '$277,786.06'],
          [ 'General Budget', 'Capital Improvements', 250000/scale, '$250,000'],
          [ 'General Budget', 'Municipal Debt Service', 5346023.2/scale, '$5,346,023.20'],
          [ 'General Budget', 'Local School District Purposes', 2733837.5/scale, '$2,733,837.50'],
          [ 'General Budget', 'Transferred to Board of Education', 760162/scale, '$760,162'],
          [ 'General Budget', 'Reserve for Uncollected Taxes', 366825.79/scale, '$366,825.79'],
          //Total General Appropriation: $84,056,327.91

          //Column 2 Water Utility; AKA Appropriation Distribution for Water Utility.
          [ 'Water & Sewage Utility Budget', 'Operating', 7402771/scale, '$7,402,771'],
          [ 'Water & Sewage Utility Budget', 'Capital Improvements', 160000/scale, '$160,000'],
          [ 'Water & Sewage Utility Budget', 'Debt Service', 2384347.98/scale, '$2,384,347.98'],
          [ 'Water & Sewage Utility Budget', 'Deferred Charges', 580000/scale, '$580,000'],
          [ 'Water & Sewage Utility Budget', 'Statutory Expenditures', 410000/scale, '$410,000'],
          [ 'Water & Sewage Utility Budget', 'Surplus (General Budget)', 1023180/scale, '$1,023,180'], //Leftover funds from General Budget.
          //Total Water Utility Appropriation: $11,960,298.98

          //Column 2 Sewage Utility; AKA Appropriation Distribution for Sewage.
          [ 'Water & Sewage Utility Budget', 'Operating', 8346932.5/scale, '$8,346,932.50'],
          [ 'Water & Sewage Utility Budget', 'Capital Improvements', 25000/scale, '$25,000'],
          [ 'Water & Sewage Utility Budget', 'Debt Service', 1279202.46/scale, '$1,279,202.46'],
          [ 'Water & Sewage Utility Budget', 'Statutory Expenditures', 206600/scale, '$206,600'],
          [ 'Water & Sewage Utility Budget', 'Surplus (General Budget)', 2991660.64/scale, '$2,991,660.64'] //Leftover funds from the General Budget.
          //Total Sewage Utility Appropriation: $12,849,395.60
        ])

   var colors = ['990066', '990066', '990066', '990066', '990066', '990066', '990066', '990066', '990066', '990066', '990066']

 var options = {
  tooltip: {isHtml: true},
      height: 1000,
      width: 1250,
      sankey: {
        node: {
         colors: colors,
          width: 20,
          label: { fontName: 'Times-Roman',
                        fontSize: 15,
                        color: '#871b47',
                        bold: true,
                        italic: true },
                        nodePadding: 15,
                        interactivity: true, // Allows you to select nodes.
                        labelPadding: 15,     // Horizontal distance between the label and the node.
        },

        link: {
          colorMode: 'gradient',
          color: {
            fill: '#CCFFFF',
            fillOpacity: 100,
            stroke: 'black',
            strokeWidth: 1
          }
        }
      }
    };
        // Instantiates and draws our chart, passing in some options.
        var chart = new google.visualization.Sankey(document.getElementById('sankey_basic'));
        chart.draw(data, options);
      }
    </script>
    <h1>Budget for the City of New Brunswick, NJ</h1>
  </head>
  <body>
    <div id="sankey_basic" style="width: 900px; height: 300px;"></div>
  </body>
</html>
